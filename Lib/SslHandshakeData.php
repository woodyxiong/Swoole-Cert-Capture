<?php

namespace CertCapture\Lib;

class SslHandshakeData
{
//    public function getClientHello($hostname)
//    {
//        $data = "1603010200010001fc0303fa8b9790c615bba36b5ac991a4bdb949a7fe6489fb8fef5e9af4094381eb556100008cc030c02cc028c024c014c00a00a500a300a1009f006b006a0069006800390038003700360088008700860085c032c02ec02ac026c00fc005009d003d00350084c02fc02bc027c023c013c00900a400a200a0009e00670040003f003e0033003200310030009a0099009800970045004400430042c031c02dc029c025c00ec004009c003c002f0096004100ff0100014700000013001100000e7777312e73696e61696d672e636e000b000403000102000a001c001a00170019001c001b0018001a0016000e000d000b000c0009000a000d0020001e060106020603050105020503040104020403030103020303020102020203000f000101337400000010000b000908687474702f312e31001500c80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000";
//        return hex2bin($data);
//    }

    public static function getClientHello($hostname)
    {
        $serverNameLength = strlen($hostname) + 5;
        $hexServerNameLength = self::dec2hex($serverNameLength, 4);

        $hexServerNameListLength = self::dec2hex(strlen($hostname) + 3, 4);

        $hexLength = self::dec2hex(strlen($hostname), 4);
        $hexHostname = self::str2hex($hostname);

        $data = "1603010200010001fc0303fa8b9790c615bba36b5ac991a4bdb949a7fe6489fb8fef5e9af4094381eb556100008cc030c02cc028c024c014c00a00a500a300a1009f006b006a0069006800390038003700360088008700860085c032c02ec02ac026c00fc005009d003d00350084c02fc02bc027c023c013c00900a400a200a0009e00670040003f003e0033003200310030009a0099009800970045004400430042c031c02dc029c025c00ec004009c003c002f0096004100ff010001470000{$hexServerNameLength}{$hexServerNameListLength}00{$hexLength}{$hexHostname}000b000403000102000a001c001a00170019001c001b0018001a0016000e000d000b000c0009000a000d0020001e060106020603050105020503040104020403030103020303020102020203000f000101337400000010000b000908687474702f312e31001500c80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000";
//        $data = "1603010200010001fc0303fa8b9790c615bba36b5ac991a4bdb949a7fe6489fb8fef5e9af4094381eb556100008cc030c02cc028c024c014c00a00a500a300a1009f006b006a0069006800390038003700360088008700860085c032c02ec02ac026c00fc005009d003d00350084c02fc02bc027c023c013c00900a400a200a0009e00670040003f003e0033003200310030009a0099009800970045004400430042c031c02dc029c025c00ec004009c003c002f0096004100ff010001470000{$hexServerNameLength}001100{$hexLength}{$hexHostname}000b000403000102000a001c001a00170019001c001b0018001a0016000e000d000b000c0009000a000d0020001e060106020603050105020503040104020403030103020303020102020203000f000101337400000010000b000908687474702f312e31001500c80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000";
        return hex2bin($data);
    }

    /**
     * convert decimal to hex and fill with zero
     * @param $dec
     * @param $length
     * @return string
     */
    private static function dec2hex($dec, $length)
    {
        // todo judge dec can saved in such length
        $hexStr = dechex($dec);
        $retStr = "";
        if (strlen(strlen($hexStr) < $length)) {
            $fillNum = $length - strlen($hexStr);
            for ($i = 0; $i < $fillNum; $i++) {
                $retStr = $retStr . "0";
            }
        }
        return $retStr . $hexStr;
    }

    /**
     * convert string to hex
     * @param $str
     * @return string
     */
    private static function str2hex($str)
    {
        return bin2hex($str);
    }
}
